<!DOCTYPE html>
<html  lang="zh">
<head>
    <meta charset="utf-8" />

<meta name="generator" content="Hexo 3.9.0" />

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

<title>6.S081-LAB3 Allocator for xv6 - YanTang Qin的博客</title>


    <meta name="description" content="Contents Requirement Analyze Implementation Break out of the limit of NFILE Optimization   More REFERENCES">
<meta name="keywords" content="6.S081">
<meta property="og:type" content="article">
<meta property="og:title" content="6.S081-LAB3 Allocator for xv6">
<meta property="og:url" content="https://qinstaunch.github.io/2020/07/10/6-S081-LAB3-Allocator-for-xv6/index.html">
<meta property="og:site_name" content="YanTang Qin的博客">
<meta property="og:description" content="Contents Requirement Analyze Implementation Break out of the limit of NFILE Optimization   More REFERENCES">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://qinstaunch.github.io/images/og_image.png">
<meta property="og:updated_time" content="2020-07-19T05:09:31.288Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="6.S081-LAB3 Allocator for xv6">
<meta name="twitter:description" content="Contents Requirement Analyze Implementation Break out of the limit of NFILE Optimization   More REFERENCES">
<meta name="twitter:image" content="https://qinstaunch.github.io/images/og_image.png">







<link rel="icon" href="/images/favicon.svg">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css">


    
    
<style>body>.footer,body>.navbar,body>.section{opacity:0}</style>

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">

    
    
    
    
<link rel="stylesheet" href="/css/back-to-top.css">

    
    
    
    
    
    
    
    <link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
    
    <script async="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    


<link rel="stylesheet" href="/css/style.css">
</head>
<body class="is-2-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/logo.png" alt="6.S081-LAB3 Allocator for xv6" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item"
                href="/">Home</a>
                
                <a class="navbar-item"
                href="/archives">归档</a>
                
                <a class="navbar-item"
                href="/categories">目录</a>
                
                <a class="navbar-item"
                href="/tags">标签</a>
                
                <a class="navbar-item"
                href="/about">关于我</a>
                
            </div>
            
            <div class="navbar-end">
                
                    
                    <a class="navbar-item" target="_blank" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                    
                
                
                <a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;">
                    <i class="fas fa-list-ul"></i>
                </a>
                
                
                <a class="navbar-item search" title="搜索" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-8-desktop is-8-widescreen has-order-2 column-main">
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-07-10T08:32:01.000Z">2020-07-10</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/操作系统/">操作系统</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/操作系统/6-S081/">6.S081</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    12 分钟 读完 (大约 1799 个字)
                </span>
                
                
                <span class="level-item has-text-grey" id="busuanzi_container_page_pv">
                    <i class="far fa-eye"></i>
                    <span id="busuanzi_value_page_pv">0</span>次访问
                </span>
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                6.S081-LAB3 Allocator for xv6
            
        </h1>
        <div class="content">
            <html><head></head><body><h1><span id="contents"><span>Contents</span></span><a href="#contents" class="header-anchor">#</a></h1><ul>
<li><a href="#s081lab3_ra">Requirement Analyze</a></li>
<li><a href="#s081lab3_imp">Implementation</a><ul>
<li><a href="#s081lab3_imp_1">Break out of the limit of NFILE</a></li>
<li><a href="#s081lab3_imp_2">Optimization</a></li>
</ul>
</li>
<li><a href="#s081lab3_iba">More</a></li>
<li><a href="#s081lab3_ref">REFERENCES</a></li>
</ul>
<a id="more"></a>

<hr>
<h1><span id="requirement-analyze"><span id="s081lab3_ra">Requirement Analyze</span></span><a href="#requirement-analyze" class="header-anchor">#</a></h1><hr>
<blockquote>
<p>Your job is to further improve xv6’s memory allocation int two ways:</p>
<ul>
<li>modify <em>kernel/file.c</em> to use the buddy allocator so that the number of file structures is limited by memory rather than <em>NFILE</em>.</li>
<li>the buddy allocator is space inefficient. The <em>alloc</em> array has a bit for each block for each size. There is a clever optimization that reduces the cost to only one bit for each pair of blocks. This single bit is B1_is_free XOR B2_is_free, for a buddy pair of blocks B1 and B2. Each time a block is allocated or freed, you flip the bit to reflect the change. For example, if B1 and B2 are allocated, the bit will be zero and if B1 is freed the bit changes to 1. If the bit is 1 and B2 is freed, then we know that B1 and B2 should be merged. Saving 1/2 bit per block matters when xv6 uses the buddy allocator for the roughly 128 Mbyte of free memory that xv6 must manage: this optimization saves about 1 MByte of memory.</li>
</ul>
</blockquote>
<p>在不使用动态内存分配技术的情况下，文件描述符的最大数量被限制在内核预先规定的<em>NFILE</em>，而使用了动态内存分配技术之后，文件描述符的最大数量就是被内存所限制了，在<em>kernel/file.c</em>中使用<em>bd_malloc</em>和<em>bd_free</em>来管理文件描述符即可。</p>
<p>维护该Buddy allocator的核心数据结构为：</p>
<figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sz_info</span> {</span></span><br><span class="line">  Bd_list <span class="hljs-built_in">free</span>;     <span class="hljs-comment">// double-linked list head node</span></span><br><span class="line">  <span class="hljs-keyword">char</span> *alloc;      <span class="hljs-comment">// bitmap</span></span><br><span class="line">  <span class="hljs-keyword">char</span> *split;</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>

<p>实际上就是Buddy算法的一种实现，用单独一个bit位来记录一对伙伴的分配与否，这对伙伴中的任何一个，无论是分配还是被释放，都将该对伙伴对应的bit位与1进行异或运算（简单来说就是，只要这对伙伴中的一个有分配或释放时，若此时alloc中相应的bit位为1，则把其变为0，反之则变为1）。</p>
<p>仅用1bit来记录一对伙伴的分配信息能够节省内存方面的开销，在整个Buddy Allocator使用128Mbyte并且最小块大小（LEAF_SIZE）为16byte的前提下，能够节约约1Mbyte的内存。计算方式如下：</p>
<p>Buddy Allocator总占用内存：<br>$$M_{all}=128Mbyte=2^{27}byte$$</p>
<p>最小Block大小LEAF_SIZE为：$$M_{leaf}=16byte=2^4byte$$</p>
<p>则有：<br>$$nsizes=log_{2}{\frac{M_{all}}{M_{leaf}}}+1=24$$</p>
<p>相应地：<br>$$MAXSIZE=nsizes-1=23$$</p>
<p>定义函数<br>$$ROUNDUP(n,sz)=(\lfloor\frac{n-1}{sz}\rfloor+1)\times{sz}$$</p>
<p>记$thr=MAXSIZE-1=22$:<br>$$M_{\alpha}=\sum_{k=0}^{thr}ROUNDUP(2^{MAXSIZE-k},8)/8+\sum_{k=1}^{thr}ROUNDUP(2^{MAXSIZE-k},8)/8$$<br>$$M_{\beta}=\sum_{k=0}^{thr}ROUNDUP(2^{MAXSIZE-k},16)/16+\sum_{k=1}^{thr}ROUNDUP(2^{MAXSIZE-k},8)/8$$</p>
<p>其中$M_{\alpha}$为每个Block使用一个bit位时位图占用的内存大小,$M_{\beta}$为每对Block使用一个bit位时位图占用的内存大小。</p>
<p>节省的内存大小为：<br>$$M_{saved}=M_{\alpha}-M_{\beta}=\sum_{k=0}^{22}ROUNDUP(2^{23-k}，8)/8 - \sum_{k=0}^{22}ROUNDUP(2^{23-k},16)/16$$</p>
<p>最后：<br>$$M_{saved}=\sum_{k=0}^{20}2^k+3-(\sum_{k=0}^{19}2^k+4)=2^{20}-1\approx1Mbyte$$</p>
<hr>
<h1><span id="implementation"><span id="s081lab3_imp">Implementation</span></span><a href="#implementation" class="header-anchor">#</a></h1><hr>
<h2><span id="break-out-of-the-limit-of-nfile"><span id="s081lab3_imp_1">Break out of the limit of NFILE</span></span><a href="#break-out-of-the-limit-of-nfile" class="header-anchor">#</a></h2><p>使用动态内存分配技术来为文件描述符分配内存，不再静态分配内存，因此注释掉<code>kernel/file.c</code>中的<code>file</code>:</p>
<figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> {</span></span><br><span class="line">  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">spinlock</span> <span class="hljs-title">lock</span>;</span></span><br><span class="line">  <span class="hljs-comment">// struct file file[NFILE];</span></span><br><span class="line">} ftable;</span><br></pre></td></tr></tbody></table></figure>

<p>重新实现函数<code>struct file *filealloc(void)</code>以及<code>void fileclose(struct *f)</code>:</p>
<figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// Allocate a file structure.</span></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">file</span>*</span></span><br><span class="line"><span class="hljs-class"><span class="hljs-title">filealloc</span>(<span class="hljs-title">void</span>)</span></span><br><span class="line"><span class="hljs-class">{</span></span><br><span class="line">  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">file</span> *<span class="hljs-title">f</span>;</span></span><br><span class="line"></span><br><span class="line">  acquire(&ftable.lock);</span><br><span class="line">  <span class="hljs-keyword">if</span>((f = (struct file *)bd_malloc((uint64)<span class="hljs-keyword">sizeof</span>(struct file)))){</span><br><span class="line">    <span class="hljs-built_in">memset</span>(f, <span class="hljs-number">0</span> , <span class="hljs-keyword">sizeof</span>(struct file));</span><br><span class="line">    f->ref = <span class="hljs-number">1</span>;</span><br><span class="line">  }</span><br><span class="line">  release(&ftable.lock);</span><br><span class="line">  <span class="hljs-keyword">return</span> f;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// Close file f.  (Decrement ref count, close when reaches 0.)</span></span><br><span class="line"><span class="hljs-keyword">void</span></span><br><span class="line">fileclose(struct file *f)</span><br><span class="line">{</span><br><span class="line">  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">file</span> <span class="hljs-title">ff</span>;</span></span><br><span class="line"></span><br><span class="line">  acquire(&ftable.lock);</span><br><span class="line">  <span class="hljs-keyword">if</span>(f->ref < <span class="hljs-number">1</span>)</span><br><span class="line">    panic(<span class="hljs-string">"fileclose"</span>);</span><br><span class="line">  <span class="hljs-keyword">if</span>(--f->ref > <span class="hljs-number">0</span>){</span><br><span class="line">    release(&ftable.lock);</span><br><span class="line">    <span class="hljs-keyword">return</span>;</span><br><span class="line">  }</span><br><span class="line">  ff = *f;</span><br><span class="line">  f->ref = <span class="hljs-number">0</span>;</span><br><span class="line">  f->type = FD_NONE;</span><br><span class="line">  bd_free(f);</span><br><span class="line">  release(&ftable.lock);</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">if</span>(ff.type == FD_PIPE){</span><br><span class="line">    pipeclose(ff.pipe, ff.writable);</span><br><span class="line">  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(ff.type == FD_INODE || ff.type == FD_DEVICE){</span><br><span class="line">    begin_op(ff.ip->dev);</span><br><span class="line">    iput(ff.ip);</span><br><span class="line">    end_op(ff.ip->dev);</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<hr>
<h2><span id="optimization"><span id="s081lab3_imp_2">Optimization</span></span><a href="#optimization" class="header-anchor">#</a></h2><p>实现一个<code>bit_flip</code>函数，在分配或释放块时用来转换相应位置的bit位，以及与之对应的判断该bit位是否为1的函数<code>bit_isset_pair</code>：</p>
<figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// There is a clever optimization that reduces the cost to only one bit for each</span></span><br><span class="line"><span class="hljs-comment">// pair of blocks. This single bit is B1_is_free XOR B2_is_free, for a buddy pair</span></span><br><span class="line"><span class="hljs-comment">// of blocks B1 and B2. Each time a block is allocated or freed, then flip the bit</span></span><br><span class="line"><span class="hljs-comment">// to reflect the change.</span></span><br><span class="line"><span class="hljs-keyword">void</span></span><br><span class="line">bit_flip(<span class="hljs-keyword">char</span> *<span class="hljs-built_in">array</span>, <span class="hljs-keyword">int</span> index)</span><br><span class="line">{</span><br><span class="line">  <span class="hljs-comment">// one bit for each pair of blocks.</span></span><br><span class="line">  index >>= <span class="hljs-number">1</span>;</span><br><span class="line">  <span class="hljs-comment">// char b = array[index / 8];    // Find the byte.</span></span><br><span class="line">  <span class="hljs-keyword">char</span> m = (<span class="hljs-number">1</span> << (index % <span class="hljs-number">8</span>));     <span class="hljs-comment">// Got the position.</span></span><br><span class="line">  <span class="hljs-built_in">array</span>[index / <span class="hljs-number">8</span>] ^= m;           <span class="hljs-comment">// Make the bit XOR 1;</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// Whether the bit in the index of array is set or not.</span></span><br><span class="line"><span class="hljs-keyword">int</span></span><br><span class="line">bit_isset_pair(<span class="hljs-keyword">char</span> *<span class="hljs-built_in">array</span>, <span class="hljs-keyword">int</span> index)</span><br><span class="line">{</span><br><span class="line">  index >>= <span class="hljs-number">1</span>;</span><br><span class="line">  <span class="hljs-keyword">char</span> b = <span class="hljs-built_in">array</span>[index / <span class="hljs-number">8</span>];</span><br><span class="line">  <span class="hljs-keyword">char</span> m = (<span class="hljs-number">1</span> << (index % <span class="hljs-number">8</span>));</span><br><span class="line">  <span class="hljs-keyword">return</span> (b & m) == m;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>将bitmap的内存分配进行优化，仅使用1个bit为一对Block进行标记，在函数<code>bd_init</code>中将alloc数组的内存分配进行修改：</p>
<figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// initialize free list and allocate the alloc array for each size k</span></span><br><span class="line"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> k = <span class="hljs-number">0</span>; k < nsizes; k++) {</span><br><span class="line">  lst_init(&bd_sizes[k].<span class="hljs-built_in">free</span>);</span><br><span class="line">  <span class="hljs-comment">// one bit for a pair of block.</span></span><br><span class="line">  sz = <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">char</span>)* ROUNDUP(NBLK(k), <span class="hljs-number">16</span>)/<span class="hljs-number">16</span>;</span><br><span class="line">  bd_sizes[k].alloc = p;</span><br><span class="line">  <span class="hljs-built_in">memset</span>(bd_sizes[k].alloc, <span class="hljs-number">0</span>, sz);</span><br><span class="line">  p += sz;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>随后，初始化的a pair of block的标记函数也需要进行修改：</p>
<figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// If a block is marked as allocated and the buddy is free, put the</span></span><br><span class="line"><span class="hljs-comment">// buddy on the free list at size k.</span></span><br><span class="line"><span class="hljs-keyword">int</span></span><br><span class="line">bd_initfree_pair(<span class="hljs-keyword">int</span> k, <span class="hljs-keyword">int</span> bi, <span class="hljs-keyword">int</span> flag) {</span><br><span class="line">  <span class="hljs-keyword">int</span> buddy = (bi % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>) ? bi+<span class="hljs-number">1</span> : bi<span class="hljs-number">-1</span>;</span><br><span class="line">  <span class="hljs-keyword">int</span> <span class="hljs-built_in">free</span> = <span class="hljs-number">0</span>, tmp;</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">if</span>(bi > buddy){</span><br><span class="line">    tmp = bi;</span><br><span class="line">    bi = buddy;</span><br><span class="line">    buddy = tmp;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">if</span>(bit_isset_pair(bd_sizes[k].alloc, bi)){</span><br><span class="line">    <span class="hljs-comment">// one of the pair is free.</span></span><br><span class="line">    <span class="hljs-built_in">free</span> = BLK_SIZE(k);</span><br><span class="line">    <span class="hljs-keyword">if</span>(flag){</span><br><span class="line">      lst_push(&bd_sizes[k].<span class="hljs-built_in">free</span>, addr(k ,buddy));</span><br><span class="line">    }<span class="hljs-keyword">else</span>{</span><br><span class="line">      lst_push(&bd_sizes[k].<span class="hljs-built_in">free</span>, addr(k, bi));</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  <span class="hljs-keyword">return</span> <span class="hljs-built_in">free</span>;</span><br><span class="line">}</span><br><span class="line">  </span><br><span class="line"><span class="hljs-comment">// Initialize the free lists for each size k.  For each size k, there</span></span><br><span class="line"><span class="hljs-comment">// are only two pairs that may have a buddy that should be on free list:</span></span><br><span class="line"><span class="hljs-comment">// bd_left and bd_right.</span></span><br><span class="line"><span class="hljs-keyword">int</span></span><br><span class="line">bd_initfree(<span class="hljs-keyword">void</span> *bd_left, <span class="hljs-keyword">void</span> *bd_right) {</span><br><span class="line">  <span class="hljs-keyword">int</span> <span class="hljs-built_in">free</span> = <span class="hljs-number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> k = <span class="hljs-number">0</span>; k < MAXSIZE; k++) {   <span class="hljs-comment">// skip max size</span></span><br><span class="line">    <span class="hljs-keyword">int</span> left = blk_index_next(k, bd_left);</span><br><span class="line">    <span class="hljs-keyword">int</span> right = blk_index(k, bd_right);</span><br><span class="line">    <span class="hljs-built_in">free</span> += bd_initfree_pair(k, left, <span class="hljs-number">1</span>);</span><br><span class="line">    <span class="hljs-keyword">if</span>(right <= left)</span><br><span class="line">      <span class="hljs-keyword">continue</span>;</span><br><span class="line">    <span class="hljs-built_in">free</span> += bd_initfree_pair(k, right, <span class="hljs-number">0</span>);</span><br><span class="line">  }</span><br><span class="line">  <span class="hljs-keyword">return</span> <span class="hljs-built_in">free</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>最后，将函数<code>bd_mark</code>、<code>bd_free</code>以及<code>bd_alloc</code>中的<code>bit_set</code>以及<code>bit_isset</code>分别替换为<code>bit_flip</code>以及<code>bit_isset_pair</code>，值得注意的是，替换<code>bit_set</code>仅仅需要对alloc位图进行bit位设置的才需要替换，而对split位图进行bit位设置的则不需要，因为split位图仍然是每个Block一个bit位，以<code>bd_mark</code>为例：</p>
<figure class="highlight c hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// Mark memory from [start, stop), starting at size 0, as allocated. </span></span><br><span class="line"><span class="hljs-keyword">void</span></span><br><span class="line">bd_mark(<span class="hljs-keyword">void</span> *start, <span class="hljs-keyword">void</span> *stop)</span><br><span class="line">{</span><br><span class="line">  <span class="hljs-keyword">int</span> bi, bj;</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">if</span> (((uint64) start % LEAF_SIZE != <span class="hljs-number">0</span>) || ((uint64) stop % LEAF_SIZE != <span class="hljs-number">0</span>))</span><br><span class="line">    panic(<span class="hljs-string">"bd_mark"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> k = <span class="hljs-number">0</span>; k < nsizes; k++) {</span><br><span class="line">    bi = blk_index(k, start);</span><br><span class="line">    bj = blk_index_next(k, stop);</span><br><span class="line">    <span class="hljs-keyword">for</span>(; bi < bj; bi++) {</span><br><span class="line">      <span class="hljs-keyword">if</span>(k > <span class="hljs-number">0</span>) {</span><br><span class="line">        <span class="hljs-comment">// if a block is allocated at size k, mark it as split too.</span></span><br><span class="line">        bit_set(bd_sizes[k].split, bi);</span><br><span class="line">      }</span><br><span class="line">      bit_flip(bd_sizes[k].alloc, bi);</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>这样修改就没有问题了： </p><div align="center"><img src="https://s1.ax1x.com/2020/07/19/URw3ZQ.png" alt="图 2-2-1 Buddy Allocator Tests"></div><p></p>
<hr>
<h1><span id="more"><span id="s081lab3_iba">More</span></span><a href="#more" class="header-anchor">#</a></h1><p>Buddy Allocator for xv6这个lab的代码量并不大，但是完全理解其中的代码还是花一定的时间，我也建议认真阅读这里的Buddy Algorithm的实现，然后参阅相关资料以及论文，关于Buddy Algorithm的，因为现在很多主流操作系统的动态内存分配技术就会用到这个内存管理算法。这里先埋个坑，我只是将这里的代码基本弄懂了，也参阅了一些非权威资料，等待我有时间并且看了论文以及相关资料会补上更专业的内容。</p>
<hr>
<h1><span id="references"><div align="center"><span id="s081lab3_ref">REFERENCES</span></div></span><a href="#references" class="header-anchor">#</a></h1><p>【1】 <a href="https://pdos.csail.mit.edu/6.828/2019/xv6/book-riscv-rev0.pdf" target="_blank" rel="noopener">book-riscv-rev0</a><br>【2】 <a href="https://pdos.csail.mit.edu/6.828/2019/labs/alloc.html" target="_blank" rel="noopener">Lab : Buddy Allocator for xv6</a><br>【3】 <em>The C programming language(second edition)</em> by Kernighan and Ritchie. Prentice Hall, Inc., 1988. ISBN 0-13-110362-8, 1998.</p>
</body></html>
        </div>
        
        <div class="level is-size-7 is-uppercase">
            <div class="level-start">
                <div class="level-item">
                    <span class="is-size-6 has-text-grey has-mr-7">#</span>
                    <a class="has-link-grey -link" href="/tags/6-S081/">6.S081</a>
                </div>
            </div>
        </div>
        
        
        
    </div>
</div>



<div class="card">
    <div class="card-content">
        <h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3>
        <div class="buttons is-centered">
            
                
<a class="button is-info donate">
    <span class="icon is-small">
        <i class="fab fa-alipay"></i>
    </span>
    <span>支付宝</span>
    <div class="qrcode"><img src="/assets/img/ali_pay.jpg" alt="支付宝"></div>
</a>

                
                
<a class="button is-success donate">
    <span class="icon is-small">
        <i class="fab fa-weixin"></i>
    </span>
    <span>微信</span>
    <div class="qrcode"><img src="/assets/img/weixin_pay.png" alt="微信"></div>
</a>

                
        </div>
    </div>
</div>



<div class="card card-transparent">
    <div class="level post-navigation is-flex-wrap is-mobile">
        
        <div class="level-start">
            <a class="level level-item has-link-grey  article-nav-prev" href="/2020/07/13/6-S081-LAB4-xv6-lazy-page-allocation/">
                <i class="level-item fas fa-chevron-left"></i>
                <span class="level-item">6.S081-LAB4 xv6 lazy page allocation</span>
            </a>
        </div>
        
        
        <div class="level-end">
            <a class="level level-item has-link-grey  article-nav-next" href="/2020/07/07/6-S081-LAB2-Simple-xv6-shell/">
                <span class="level-item">6.S081-LAB2 Simple xv6 shell</span>
                <i class="level-item fas fa-chevron-right"></i>
            </a>
        </div>
        
    </div>
</div>



<div class="card">
    <div class="card-content">
        <h3 class="title is-5 has-text-weight-normal">评论</h3>
        <script>(function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/zh_CN/sdk.js#xfbml=1&version=v2.8";
    fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<div class="fb-comments" data-width="100%" data-href="https://qinstaunch.github.io/2020/07/10/6-S081-LAB3-Allocator-for-xv6/" data-num-posts="5"></div>

    </div>
</div>
</div>
                




<div class="column is-4-tablet is-4-desktop is-4-widescreen  has-order-1 column-left ">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered" style="flex-shrink: 1">
                <div>
                    
                    <figure class="image is-128x128 has-mb-6">
                        <img class="" src="/images/avatar.png" alt="QinStaunch">
                    </figure>
                    
                    <p class="is-size-4 is-block">
                        QinStaunch
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        梦想是做出优秀的开源产品
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>四川成都</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        <nav class="level is-mobile">
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        文章
                    </p>
                    <p class="title has-text-weight-normal">
                        21
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        分类
                    </p>
                    <p class="title has-text-weight-normal">
                        14
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        标签
                    </p>
                    <p class="title has-text-weight-normal">
                        10
                    </p>
                </div>
            </div>
        </nav>
        
        <div class="level">
            <a class="level-item button is-link is-rounded" href="https://github.com/QinStaunch" target="_blank">
                关注我</a>
        </div>
        
        
        
        <div class="level is-mobile">
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="Github" href="https://github.com/QinStaunch">
                
                <i class="fab fa-github"></i>
                
            </a>
            
        </div>
        
    </div>
</div>
    
        
<div class="card widget" id="toc">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                目录
            </h3>
            <ul class="menu-list"><li>
        <a class="is-flex" href="#undefined">
        <span class="has-mr-6">1</span>
        <span>Contents#</span>
        </a></li><li>
        <a class="is-flex" href="#undefined">
        <span class="has-mr-6">2</span>
        <span>Requirement Analyze#</span>
        </a></li><li>
        <a class="is-flex" href="#undefined">
        <span class="has-mr-6">3</span>
        <span>Implementation#</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#undefined">
        <span class="has-mr-6">3.1</span>
        <span>Break out of the limit of NFILE#</span>
        </a></li><li>
        <a class="is-flex" href="#undefined">
        <span class="has-mr-6">3.2</span>
        <span>Optimization#</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#undefined">
        <span class="has-mr-6">4</span>
        <span>More#</span>
        </a></li><li>
        <a class="is-flex" href="#undefined">
        <span class="has-mr-6">5</span>
        <span>REFERENCES#</span>
        </a></li></ul>
        </div>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            链接
        </h3>
        <ul class="menu-list">
        
            <li>
                <a class="level is-mobile" href="https://leetcode-cn.com/u/qinstaunch/" target="_blank">
                    <span class="level-left">
                        <span class="level-item">My LeetCode</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">leetcode-cn.com</span>
                    </span>
                </a>
            </li>
        
        </ul>
        </div>
    </div>
</div>

    
        
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                分类
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="/categories/Framework/">
            <span class="level-start">
                <span class="level-item">Framework</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/Framework/Mybatis/">
            <span class="level-start">
                <span class="level-item">Mybatis</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/Java/">
            <span class="level-start">
                <span class="level-item">Java</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/Java/Java编程语言/">
            <span class="level-start">
                <span class="level-item">Java编程语言</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Java/algorithms/">
            <span class="level-start">
                <span class="level-item">algorithms</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Java/并发控制/">
            <span class="level-start">
                <span class="level-item">并发控制</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/Unclassified/">
            <span class="level-start">
                <span class="level-item">Unclassified</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/操作系统/">
            <span class="level-start">
                <span class="level-item">操作系统</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">13</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/操作系统/6-S081/">
            <span class="level-start">
                <span class="level-item">6.S081</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">5</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/操作系统/MIT-6-828-OSE/">
            <span class="level-start">
                <span class="level-item">MIT-6.828-OSE</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">5</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/操作系统/csapp/">
            <span class="level-start">
                <span class="level-item">csapp</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/设计模式/">
            <span class="level-start">
                <span class="level-item">设计模式</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/译文/">
            <span class="level-start">
                <span class="level-item">译文</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/译文/杂记/">
            <span class="level-start">
                <span class="level-item">杂记</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li></ul></li>
            </ul>
        </div>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            标签云
        </h3>
        <a href="/tags/6-S081/" style="font-size: 20px;">6.S081</a> <a href="/tags/Algorithms/" style="font-size: 10px;">Algorithms</a> <a href="/tags/Java/" style="font-size: 10px;">Java</a> <a href="/tags/MIT6-828/" style="font-size: 20px;">MIT6.828</a> <a href="/tags/Mybatis/" style="font-size: 10px;">Mybatis</a> <a href="/tags/No-tags/" style="font-size: 10px;">No-tags</a> <a href="/tags/csapp/" style="font-size: 16.67px;">csapp</a> <a href="/tags/并发控制/" style="font-size: 10px;">并发控制</a> <a href="/tags/杂记译文/" style="font-size: 13.33px;">杂记译文</a> <a href="/tags/设计模式/" style="font-size: 13.33px;">设计模式</a>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            最新文章
        </h3>
        
        <article class="media">
            
            <a href="/2020/07/14/6-S081-LAB5-Copy-on-Write-Fork-for-xv6/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="6.S081-LAB5 Copy-on-Write Fork for xv6">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-07-14T14:10:30.000Z">2020-07-14</time></div>
                    <a href="/2020/07/14/6-S081-LAB5-Copy-on-Write-Fork-for-xv6/" class="title has-link-black-ter is-size-6 has-text-weight-normal">6.S081-LAB5 Copy-on-Write Fork for xv6</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/操作系统/">操作系统</a> / <a class="has-link-grey -link" href="/categories/操作系统/6-S081/">6.S081</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/07/13/6-S081-LAB4-xv6-lazy-page-allocation/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="6.S081-LAB4 xv6 lazy page allocation">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-07-13T05:28:06.000Z">2020-07-13</time></div>
                    <a href="/2020/07/13/6-S081-LAB4-xv6-lazy-page-allocation/" class="title has-link-black-ter is-size-6 has-text-weight-normal">6.S081-LAB4 xv6 lazy page allocation</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/操作系统/">操作系统</a> / <a class="has-link-grey -link" href="/categories/操作系统/6-S081/">6.S081</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/07/10/6-S081-LAB3-Allocator-for-xv6/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="6.S081-LAB3 Allocator for xv6">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-07-10T08:32:01.000Z">2020-07-10</time></div>
                    <a href="/2020/07/10/6-S081-LAB3-Allocator-for-xv6/" class="title has-link-black-ter is-size-6 has-text-weight-normal">6.S081-LAB3 Allocator for xv6</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/操作系统/">操作系统</a> / <a class="has-link-grey -link" href="/categories/操作系统/6-S081/">6.S081</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/07/07/6-S081-LAB2-Simple-xv6-shell/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="6.S081-LAB2 Simple xv6 shell">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-07-06T20:36:48.000Z">2020-07-07</time></div>
                    <a href="/2020/07/07/6-S081-LAB2-Simple-xv6-shell/" class="title has-link-black-ter is-size-6 has-text-weight-normal">6.S081-LAB2 Simple xv6 shell</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/操作系统/">操作系统</a> / <a class="has-link-grey -link" href="/categories/操作系统/6-S081/">6.S081</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/07/04/【译文】Bell-Labs-and-CSP-Threads-Russ-Cox/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="【译文】Bell Labs and CSP Threads, Russ Cox.">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-07-04T11:04:21.000Z">2020-07-04</time></div>
                    <a href="/2020/07/04/【译文】Bell-Labs-and-CSP-Threads-Russ-Cox/" class="title has-link-black-ter is-size-6 has-text-weight-normal">【译文】Bell Labs and CSP Threads, Russ Cox.</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/译文/">译文</a> / <a class="has-link-grey -link" href="/categories/译文/杂记/">杂记</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            归档
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2020/07/">
                <span class="level-start">
                    <span class="level-item">七月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/05/">
                <span class="level-start">
                    <span class="level-item">五月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/01/">
                <span class="level-start">
                    <span class="level-item">一月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/10/">
                <span class="level-start">
                    <span class="level-item">十月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                标签
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/6-S081/">
                        <span class="tag">6.S081</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Algorithms/">
                        <span class="tag">Algorithms</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Java/">
                        <span class="tag">Java</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/MIT6-828/">
                        <span class="tag">MIT6.828</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Mybatis/">
                        <span class="tag">Mybatis</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/No-tags/">
                        <span class="tag">No-tags</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/csapp/">
                        <span class="tag">csapp</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/并发控制/">
                        <span class="tag">并发控制</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/杂记译文/">
                        <span class="tag">杂记译文</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/设计模式/">
                        <span class="tag">设计模式</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
    
    
        <div class="column-right-shadow is-hidden-widescreen ">
        
        </div>
    
</div>

                
            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    <img src="/images/logo.png" alt="6.S081-LAB3 Allocator for xv6" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2020 坚定qinyantang.&nbsp;
                Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> & <a
                        href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a>
                
                <br>
                <span id="busuanzi_container_site_uv">
                共<span id="busuanzi_value_site_uv">0</span>个访客
                </span>
                
                </p>
            </div>
            <div class="level-end">
            
                <div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle">
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Creative Commons" href="https://creativecommons.org/">
                        
                        <i class="fab fa-creative-commons"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/">
                        
                        <i class="fab fa-creative-commons-by"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="My Github" href="https://github.com/QinStaunch">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                </p>
                
                </div>
            
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("zh-CN");</script>

<script>
var IcarusThemeSettings = {
    article: {
        highlight: {
            clipboard: true,
            fold: 'unfolded'
        }
    }
};
</script>


    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>



    
    
<script src="/js/animation.js"></script>

    
    
<script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
<script src="/js/gallery.js" defer></script>

    
    
<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>

    
    <script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>
    
    
<a id="back-to-top" title="回到顶端" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>

    
    
    
    
    
    
    
    
    
    
    


<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="想要查找什么..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: '文章',
                PAGES: '页面',
                CATEGORIES: '分类',
                TAGS: '标签',
                UNTITLED: '(无标题)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
</body>
</html>